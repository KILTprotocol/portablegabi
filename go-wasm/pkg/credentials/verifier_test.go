package credentials

import (
	"encoding/json"
	"testing"

	"github.com/privacybydesign/gabi"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
)

func TestRequestPresentation(t *testing.T) {
	sysParams, success := gabi.DefaultSystemParameters[KeyLength]
	assert.True(t, success, "Error in sysparams")
	disclosedAttr := []string{"contents.special", "ctype"}
	session1, msg1 := RequestPresentation(sysParams, disclosedAttr, true, 1)
	require.NotNil(t, msg1)
	require.NotNil(t, session1)
	require.Equal(t, msg1.Nonce, session1.Nonce)
	require.Equal(t, msg1.Context, session1.Context)
	require.Equal(t, msg1.PartialPresentationRequest.RequestedAttributes, disclosedAttr)

	// nonce should be random
	_, msg2 := RequestPresentation(sysParams, disclosedAttr, true, 1)
	require.NotEqual(t, msg1.Nonce, msg2.Nonce)
}

func TestRequestCombinedPresentation(t *testing.T) {
	sysParams, success := gabi.DefaultSystemParameters[KeyLength]
	assert.True(t, success, "Error in sysparams")
	disclosedAttrs := []PartialPresentationRequest{
		PartialPresentationRequest{
			RequestedAttributes:   []string{"contents.special", "ctype"},
			ReqNonRevocationProof: true,
			ReqMinIndex:           1,
		},
		PartialPresentationRequest{
			RequestedAttributes:   []string{"contents.age", "ctype"},
			ReqNonRevocationProof: false,
			ReqMinIndex:           1,
		},
	}
	session1, msg1 := RequestCombinedPresentation(sysParams, disclosedAttrs)
	require.NotNil(t, msg1)
	require.NotNil(t, session1)
	require.Equal(t, msg1.Nonce, session1.Nonce)
	require.Equal(t, msg1.Context, session1.Context)

	// nonce should be random
	_, msg2 := RequestCombinedPresentation(sysParams, disclosedAttrs)
	require.NotEqual(t, msg1.Nonce, msg2.Nonce)
}

func TestVerifyPresentation(t *testing.T) {
	bytePresentationResponse := []byte(`{"proof":{"c":"fKzT10A8L3TxppRUYA466RwszPbpPTefkWHmlDTSWms=","A":"eA6WqGi1UsfDdpAg4A2Y3FGF8oChS/S5h08liiRa8FcwZhKmeOnyapo4ynNexNqqEJx2oF6rSwHpgCsu9vWvobOcQzF+86BCgl+PPYuXYa+eW+W/7Ebl0/rnQvcAagJmuvvYcos+Y1FAsCARsHtdXWGXAZ8B0NhiI35gXc86nRE=","e_response":"UHYkCaPC+estNJJm7RDPnpRWm0f+BN0mWllLtdoniQZjdrG8n6PFbawlP5Ip5cRmgwqx40G633PE","v_response":"DFwaLUnmXi1iooy/z/AIHExSZsTromKSMS5phblBilCOmrITPt+OFjSF3766R1EMmBtCXBAoKBD4dc7MsysVo7cX4wrbBzn/sqzPX8uVAz+rREqitwLYtSaHYMaD6A614qopdZ+StRMpFo25JYZSCibcPCaEpK3nGwFvz/PHhvt/am5ZxBLpQdtO3grOpm5NEGQlDIe7XZYnQuRRUYZU6UWAsEX6QvH6BaJCBiqn1Q9CdMiAWlrzUCFHGVqSfSECm/czp9l+cOwrqaK5ZWwqox6oWgn0OebUQ+ICCt0y+NrowXMfg5FZ/dDEzV+V728mSmFP72RzSLe3cwjrSHdb","a_responses":{"0":"2TxsQxP9oK3gyjN4/bTxNUEJwNrKsHeJGISDzjp3l8oYs2/TOho+SbA4TXSXAKYdHCfRutl7ZfruS1Znh3O02DJ9KCrgkfg5CQo=","5":"ZnGJ9nxFJspJhcREhJjzSL60z58Gr7WU0tP0nEpPL8t+jkGRCIrW9JhqQWt6mRb2qQSQvZNNY4lSU1swzxVMp6TY4/kK3sZzN6Q="},"nonrev_response":"A7PWtLUjYz6eVj5ls5UMT2jzPGPx2hBqfGk3JZmPCcwSzDPmVbYDt+LIzWruHkmCCB+cOZProwXyYjlTqgHXii6iTemxJjx0/A==","nonrev_proof":{"C_r":"WniQjSIfNAXrTF2k95eD84pl0DM9uMRmowcx7UiawMSALm9/VSqL5GBtlecLP18LrTJN8sR6tPL0TEhLt3QRaPTehD9grJn1rqu3XNGUE16CrzM8Wabl5F5Vt2qxNpteG35tyKFihwwN5TIN035OEg39cgIfc//eHrTBlapsrKE=","C_u":"U/DhHaT7wfdF0MhlxNAJ+BwJaE/LAJENXw+IK35E/mym/LcY4+2HplndyR4rZikbKASIOycVZ15sBE1CLR12E+D7uGOtc77PjJsmYpgudTPWNfutZJEQfkw3Tqk+hk6JAgJhITwsdSsJ6Iq6op+v2b8bRYCw8p5xBh88w1qOYu4=","responses":{"beta":"Xgi4R2keUAV3u7aOLaZsknO1AUlhekSnn064IzrkR8VfGaiFhHEEWGvrre3lCvH2UAZlZaiJZ0IAax38A80i0zHeKEdXnAcEQv+s6pl1rHyVKiECdtP3EuYzt8Ka+SfHNrmOAfPviZMHMUjT/9o8xXgc12PJHSv1hyTGVPxxq0lSQoCJrwjmOJ3EP9TfEXyEdjTgHhS/yr8dM1zq6KQuih7WMALUIvpKL9hd80RuQdDls/efNfWX3+Kzq2SaVPlbDWXVWRRneHg=","delta":"MV0+grQTScslaWZDIX0tW/37QTLuKtU7siATnV2KO37qAUd89SsMJ7j74wz8EWQibpvsVhi4XDY1ZYxeiwNKyGplXg6lvONTohEDzc1+m3gzDk/PK14TPWK+ApyJGLilhF8mXaNVLoe/hN+AsDVU7IV9EuWslstVHMbC+xKZWwKxVxKWp4hrW48cURxgI5itKbZsuEHBZ1xQqv2/yRfw9wzcSREf+UBS7K6V6dCy/53Iv46u6y4xqiEiNaj4ZC8Ibw6KK15Dnxk=","epsilon":"Dqd1U6lZcejzeu6DWNFaUbwPzNeqdL+6OrFq27tuQ3GIaiO+yvJ1rlNp/Zm3BnyWZUhKjY4t8qdjbwh69ZiUeooAMbQ4o3TEKlgaOrImRbjUU1QK68bVTXHYZG6UKuK62tbqO4atYn2/KsMdVVKRfbwej27d83OiLycMoJ4r62EeMky8+9vdQnCzxmMBDXERBJnPh0uVgbucWZrc3ZpL733iVgT6/H9HMO/cCmebfi0=","zeta":"BhhxQuPSMRz5yi7c2Wscoqsqfs0PpL/rPxn60ye05YPK+Fni5aF6v0ofSbwXkMWCF4ds13VQT7cQr0UOOVWwgN8UobMcHy+etGL4QgNN85W7AvRTyBVo/ICYm/hDe/XuUxa6Z6cDCaYtq307ZzwpUy6nN6+rJmuAkASMTXEMFm1JvrVF5GndQDmnYo3uf3WzWwFThhQvabLWD7dx4s+2tpHYjVN4XzSvdgbh2evkZRI="},"sacc":{"data":"omNNc2dYu6NiTnVYgClRGy6x9OmGxC4znH5G5prZK3sfFOylRkBn2DOuxlTY9y2eDqdg3T5oKJrk9VavK4BqJ+JFTGwl+fb+hLeD9FTjBQWJPy+pDNly78LiKCqJPtWxu9IG2cjo1ujH/XQVuqReDQNiFRCSpChvALFukU3c2nyfuY9pWX6QtcUGYKQOZUluZGV4AWlFdmVudEhhc2hYIhIg542kR7yDoMEFhYbUEni4Da0kZK3162KvG7Gb79HlbbtjU2lnWEYwRAIgSpr8tfgCxwiX1lu6yL3y9bWFDCYoVs9YXWpKoeGwruECIFw4hBtgWBC6iiMpFdJ12IL1uoLtLPDG+E6HKwYoM3Cp","pk":0}},"a_disclosed":{"1":"/wAAAAAAAAAMY29udGVudHMuYWdlAAAAAAAAAAVmbG9hdAAAAAAAAAAIQEEAAAAAAAA=","2":"/wAAAAAAAAAPY29udGVudHMuZ2VuZGVyAAAAAAAAAAZzdHJpbmcAAAAAAAAABmZlbWFsZQ==","3":"/wAAAAAAAAANY29udGVudHMubmFtZQAAAAAAAAAFYXJyYXkAAAAAAAAAFP9beyJhIjoxLCJiIjoyfSwyLDNd","4":"/wAAAAAAAAAQY29udGVudHMuc3BlY2lhbAAAAAAAAAAEYm9vbAAAAAAAAAABAQ=="}}}`)
	byteVerifierSession := []byte(`{"context":"9IdX3lew9qN2aBxlZysRUf9ydTxS1Gv7A8ZAF1bEXpA=","nonce":"TgcBir4IGCBnn13fqDRyPaSKKkB3MAmvcu+N7gYF3z0=","reqNonRevocationProof":true,"reqMinIndex":1}`)
	bytePubK := []byte(`{"XMLName":{"Space":"","Local":""},"Counter":0,"ExpiryDate":1611327166,"N":"g3gmc0wLonnGSU/7F/gjm3nlPk3zOXQUKsPLlgqW6nQmp/oa6UHkP4NFROHPm8Jk80rKGlWx/hfaRElDSzBVSQ+vv3v9oTsC4AE/2dTZ2EzhS3DVPfARfuFsPphv20tUQXqmXiECxiL20+ZR8iK/A54evnXHtScJchdM88QnJ1U=","Z":"dLm4b8HFf9yRCZcycHeISsht74QFWWd2Fcq8ndf5KWzlCPnHOuIpwGWa7G5ioPkJOFKSSG+9WW1EL+kTVnqd4bZEV/QC8kzY7HcbnE+8YThDde1tj+Uh/erV4ejPav2B/8Iwx7pWrNyY6srhZcAnJ3ct4pZxjpWsidYWeBeMZLE=","S":"Z5QqW4NMZvgG3+KgfsCJNxHM1w+uQzOHTWa91I25wkPdL/Kl9+lVOM0/U5l7BYDGDmPIe4O3vimZsgWggmFTbJqmVEZR1SkCONQqoDvB1CZby4G2NvrNbD5LwhUaqyjaoyxnjzSQeLp51EtvVSK5g+bXjWxxXnuMawjKLNLGpaw=","G":"dXTJQ1fKPXL6CvOkc/0bLLOx4tJbJ2QJXW4lav/b8efoYUsgIEZvxpt0ffPSK2gMpuIY/hknkvpVkyeovQyKG5R72W1dQj1OVTLe8JaZuULPOu1XSU7xShTb9pCXXDyAFVrnHO9NiCLb1SHpROTZXAbP2+IIVITYxisjmzEhkis=","H":"Wjj/mNb3yqkPlC6ctdlXCCsIK7tYrqQTTwqeK6RReZj28OqmyMHGW/qMBxzZQ96J63dlDDk02DJ9VtOfvj3/ZctlRdKdm0hlqc1v3FNgS2/jxM61xYKPn03tXAstBmSUk8urZO1jwyhUcpBiofLYVVcdq/fvbX4vk3Q6wFWthUE=","T":"djPZ8N+1iQh3rgOrRuFh9SmRRGPs3Wb8s21570rLPxq3tXVqD6rEet+cbeavZmaN9TCj+jJO3XH7G1gWdCR8G+CimJh4qolJ1N5BO13CX814KM5uzAxA8sK8fWMevsCzUOJtSVP/p1CXBd7m30xWfnF35uSL01WnnywaF+k0VQw=","R":["ZachH9LVzrV9ynbJbx4yCndGUuIPC946xqKHw6lUqc3AIm9AcezZlsb29Z4hkG/t/N6h1dsLFLCZXos0NkvEKUd5FhUQ2RL0Gq8l/mAK/bOUv0Om3blzWmkOZLp2W00sIxblNSGV0WxzgLsu6gIUIwTzr9XNulNIkPNJ9BDJo8g=","CPqrlPcnGN8zdGETlaGeElXCjzG9+Z9FJ2BJI+f+5Vgky3IHUDnVTmqmaZkKi6Fwxa/DJE9F3WF2RaEqXtzoBerp5CH95IMYyFY2ONkFGzExdbj5TCaZqJ4i/hM/ecozXUHpQRG0/LTd8dieLXMqDwUxSGOnrw6ws4Gq/8IuWt4=","IYc66imeom1EA9x+lLt0DVMfkF3RvuC2mIyCF3WopkufdWhs/lc/USrkPBEg3kA6aROAXMDwb4tS/64RIe5u3Qh8K2n5wDTXxNGdj4N/dTwueRty20dq+XR8zyzJC5FcMrvEYSshG+wQ1Ske1BQZ8khncxE+omXoWIbsgQkFxKE=","dpeCKLimn5s+cRe6bGZmlgFhiql3rsd4EIN3N1NPUjHm+1oIKa6P0XVbZKY23PyLKIYxf8bLZ97AS/J76TKYExvXOPJYa0G8OEUCf31fUDg9VneHGAceRIO0z8oE7uZvd0q/IFhfcgoh8b1zN14QXAj7UKQJrAUUFPBXlJ4DhDs=","PviypJdPCQ07lMh8OpLPQxC4Z4IdDmqSBxr/nBaz+q1a1wTYGbNMcZ0dq/IPqAlu9lgW0v79NBWqpwppZobcouzd30Zjx9FUjeWpDlI+Q2MsLWCiINHC1sXl/GpbNDY+F+Skv3blwrxB+kkbWsBmUNv4BrN2QhUl6cNu4iUefuw=","JHLa92U8y3XeuKB+sscDgmuXGi141BhLEKYR7uaUszUzjmawizVAiJ94Q0oDkdw99HTndIdx6G5CAFxhXZltq5h/f34UbysIxxoL98GqucWcMrx3EqqpvQTZNaLsbegVZr6sr0dx45MlOCuxXPiLdz/i5X4bxfWxWmm2p7jFLDw="],"EpochLength":432000,"Params":{"LePrime":120,"Lh":256,"Lm":256,"Ln":1024,"Lstatzk":80,"Le":597,"LeCommit":456,"LmCommit":592,"LRA":1104,"LsCommit":593,"Lv":1700,"LvCommit":2036,"LvPrime":1104,"LvPrimeCommit":1440},"Issuer":"","ECDSA":"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEIZD3jGh+Zmh8FkY81att8iDrqgqx0b4i8rvh7NxQGarcXknN4Qv6MDTs2SgwKHyoKeX+FADbmLb98FGoV1iGHQ=="}`)

	pubK := &gabi.PublicKey{}
	err := json.Unmarshal(bytePubK, pubK)
	require.NoError(t, err)

	presentationResponse := &PresentationResponse{}
	err = json.Unmarshal(bytePresentationResponse, presentationResponse)
	require.NoError(t, err)

	verifierSession := &VerifierSession{}
	err = json.Unmarshal(byteVerifierSession, verifierSession)
	require.NoError(t, err)

	ok, claim, err := VerifyPresentation(pubK, presentationResponse, verifierSession)
	assert.True(t, ok)
	require.NoError(t, err)
	require.NotNil(t, claim)
	require.Contains(t, claim, "contents")
	content, ok := claim["contents"].(map[string]interface{})
	require.True(t, ok)
	assert.Contains(t, content, "age")
	assert.Contains(t, content, "gender")
	assert.Equal(t, content["age"], 34.)
	assert.Equal(t, content["gender"], "female")
}

func TestVerifyCombinedPresentation(t *testing.T) {
	byteVerifierSession := []byte(`{"context":"2wfkK4gbrLeq11bSehr5r/jUkQVwiluwBUePQoxm6b0=","nonce":"h6rWOZHbj9vkOTFh33wRjMhgW2Q+7YI+yR0lwHoXZ3I=","partialRequests":[{"requestedAttributes":["contents.age","contents.gender","contents.name","contents.special"],"reqNonRevocationProof":true,"reqMinIndex":1},{"requestedAttributes":["contents.name","contents.likedNumbers"],"reqNonRevocationProof":true,"reqMinIndex":1}]}`)
	bytePresentationResponse := []byte(`{"prooflist":[{"c":"TsxeePNcCRhYWJzc/cZ2sQf29taCkLpJPYaWddRf85g=","A":"z5xTl1EWxzkIttrWh9yGiQfh6xjl1yq7/iTCMks8VCiBJTXA//nvaP6ANrH1IpsFJuFbSePx/r+uFWAjst46MaPB5CRnnPLY9qPYFxuGZeYsjGit0FUsDQHQTiCqgLI9AjiOVXhgEUVL1Ps0C7l9Vvl9Ugr4R+8fcVTYanxnOoM=","e_response":"xOIIkkQv65/Ax8uhj8VGUzWSVrc6Jx/rokvrhN5DqXZJ9QHLj4VT6wzUiFtVAtWTkYi0Zw8RdlDz","v_response":"Bh3PxScFOsWR0QFcqYerXQ5RGAOgnFLs+rN3iSU6RKXhALzHOY7+HVwiZw8rgwmbtze3KLFAU83TO8BoxfegaY1244sVEJrM/IIGdRkrIsovzK7U6SVULeHYOBNmoo8CmuqDYey3kGjmGU4VhgbG9JVjIhtRKhtkUdpvJrxlGuSykT4hmi0sm9pzOHofTGn5w+BrEEh1gDeyjOEsY+eh79ks660RBsCW25z0pkpWhDxPQ3d5L7IZXq9WbkejJ8L3atd37MXea11Otf0zhN8kD0D1cSrIXsRLJFUxpA7tcXUShCTK8uw1MzJPcv/c3IuZxDs2drsWPOdhHy6BSa7n","a_responses":{"0":"hzuzfei2WDaZAFkel/idaTyl0lclq/wtI6Zmr1KWYfJKYhC8YxTe/mfLsPv2lEuvXli6jUJAoGdr0FeDLrzoiv0Q32eUiXg2mz0=","5":"wEJnx537UKLzmgqkPeRyFY6Nv3+OK0wBEaXnJqXUqPdGtBJ1LdkGQt5IxgpmRSGvLUozuvJ1G15KP6pUGFo8xu5u4GMICYDEPVA="},"nonrev_response":"BinztDiegx1dtjtgzQz/8f2OOKNEtd66XzbEHUxl8b6nLgdEeMCOQCMnHYLIE299+0CRBXfTnp6mFmJA5Jaepct3y9x2mSoyfQ==","nonrev_proof":{"C_r":"I3sWG9cnkLB15c4c48kgY4ycBlLYIGF0gwFmUWhUOUGehnxjuvnbXwjT35X1Klf7V6by4CmrPvKWC2mTiQYhBxAIo4966N6k2fy+Wrn1RFpRbVaMVwxa47T2uXxEnQZDDCR27AsCOH6TbTD8lbgBW7iT7nopcTykN+IeOV6Qhjg=","C_u":"ryis3rmVYbt9paPlNW3U4NbuMhTPa2mIJ6bbp6DDim1PzX6a353Ay7EhRC3RqKGbDdQoGkIi6GLkE828LdNusf47zj0ePPpVkD4T2t96qlzPUlfepb1NkcbXwddqjMFW9oQFVv2xJOuxi3LGQUwuW+w+X/EV9nWmaNZdbFkFKe4=","responses":{"beta":"AQpyp0dNS1NPLS6BHo+c1toKoS5wTG+vQQBztBQwjzOuWJZcvktuMS6qci6elvop47JBh5WgmyG8YBdAdPIFuFl+GFamxacyF9eLVJ4XeFShz8RGUbZAMYOfOITAzgr4rwgA2ovHNpjhOZBu2h9qoPptbsnER/YbU06MUMT/IzI9DSq/h3tFCFXHDiSG2J4gFWlVlVj+c/uU97GJR27UMDNVjtH6qnqIA6AY7WI4POv6Y2IG33NLHfhfi3Fo0PP5SN84ZBXmBOhx","delta":"oiJCm26R5rK728F+OlMLnMMKpNfrIbPS0QfF/vsLMhH+h7O4NECflaI/pEdvmp31AhQ8b6pA8/wnRmKH67OiXAksGUFuZSgBIgnuP/pgqH/a6PoMRYkQA9Ryr1s/Rzwl3IGfUSASwQWDoxeL2ITdqgVBRaBYTEjlR/+oA2X8zIqaO1V7CG1f+EgV+r4fn//bc8DhWdF6KXlG/l5I7cJyoc6fQZK//sFKfxnFR2QIby7v9lhiYf/rntifUwKCxmJ9c+12xgEUnjI=","epsilon":"E5Cf6HstqiQmt2a6boDv1uDMPZ4ro/OOy+IGjoas2lisyec0RQewiAJa2bFSoSaoBYpDthqZxEGaUa2GwPRbyV3pBn2RFat6oLisrAkld5khPECXtAkTMtbgXmbTQExP/ITiT2UH/NxzYZ7N/RD5WzJB7XXu5w8xKBCa7ACfnFutDfSlUe+jmNLQ+34oyHEwmXh+TpvezhmSimYWXIEb+rATg1BInfsEmtF5Kf0JUOc=","zeta":"H1pOIg5OfuGd2D5J9vw2kOux9JJPfU854J2QACrcbI6CCPOA3g39FhVuDmk0DpIa2M8OtjMM5JhlcIC05jRa9lSuoVlkb3XHI17NDqczjXDTgbJFph5vR3JST57I0ao3H5lBLL0qNrGQRmc7zu4hEoOtTycNFXdRF+euejk/erShyc6EnJlpe0iD2bx3o4Yg8dI1K9MUvjBFCLWh8MuPAXa2JJJrBWy4f9qnlw2htMo="},"sacc":{"data":"omNNc2dYu6NiTnVYgCWGEk2iO53pavztto18GQ+K7W4x2iu9gx4IKMPQW98OeI5Eg1mCWSEm5Apjk6pi5JEY4zAUQnfKn+uN7kXk3A5ff5zFWB5+5TFggI73PytCps+owq+wxuXlljcV6pZRQXhDt+WnajAQZmEavIH9R4vnajjcnMkK96Muk6j2jTr+ZUluZGV4AWlFdmVudEhhc2hYIhIg542kR7yDoMEFhYbUEni4Da0kZK3162KvG7Gb79HlbbtjU2lnWEgwRgIhAMt9fdJBsAEpvfW3g8je3+hUIJ0lNnEKi/iS4PQlMSaiAiEA5aP5iigzBqCjcpeUSLF67ndV/sk4DqI7oI96PZVqWjg=","pk":0}},"a_disclosed":{"1":"/wAAAAAAAAAMY29udGVudHMuYWdlAAAAAAAAAAVmbG9hdAAAAAAAAAAIQEEAAAAAAAA=","2":"/wAAAAAAAAAPY29udGVudHMuZ2VuZGVyAAAAAAAAAAZzdHJpbmcAAAAAAAAABmZlbWFsZQ==","3":"/wAAAAAAAAANY29udGVudHMubmFtZQAAAAAAAAAFYXJyYXkAAAAAAAAAFP9beyJhIjoxLCJiIjoyfSwyLDNd","4":"/wAAAAAAAAAQY29udGVudHMuc3BlY2lhbAAAAAAAAAAEYm9vbAAAAAAAAAABAQ=="}},{"c":"TsxeePNcCRhYWJzc/cZ2sQf29taCkLpJPYaWddRf85g=","A":"mPi7bJ+nrmHrTSVnxbDFNjDWgxyHhpwgwtjn7Fku7bhSMmyKllxoMggJyyyUm6VE7XhzOpDU/OW3Rls3+958Juz/8wvY2ggbaphlunKPj8i1nITBDEHwG3+FKVSl3e4BOe+lhyt/bUpnkYirIYi1D5NSRRclQxxS6MkOrPtivsI=","e_response":"cEaCziG8JNAFtKIPZBWPRT0pgs5dBnhZ8hcb2BqBJENOdR6GWLhOPgY3juPjZqmMquQye2bVWVO7","v_response":"DDiwWbX2XkfgAYK8gN3S+PzPTErkxR3bLiFgDuu9jU/3eVM218aY3GIaXb1reKQrV6MtDFym7dX3KUfXpW9+O6V+V3++Q07jR4i1isR78f3ARBG3RI5v45K9Hfa+vlaZkTEXt2dOiFps4uzJh92gm4owuJQ2q4GsDbRc/UOSUnnHQ+J6j+UkvYFxKzLPK35f2vZWUlVDMPq/npMw5vY89q8Vhj6Y0ZSWfW+TDBw3TmBVwIMRUuvvxNc0LVCbb+eszC8lzPqLI7UL45Q3m4f2ziTCr7WSpzX+mO2MeVTla2ZV7o/DpN4p/uWWv9RiQJhcW+jZa0s+XO64jxwnfkem","a_responses":{"0":"hzuzfei2WDaZAFkel/idaTyl0lclq/wtI6Zmr1KWYfJKYhC8YxTe/mfLsPv2lEuvXli6jUJAoGdr0FeDLrzoiv0Q32eUiXg2mz0=","1":"A3TXU5sIXYtu+mJ+yI1XoFjHjavrx1KR+pqAVA1ALb5P2dRSwArzxUTn5wM1ZO5MZB6doj5tbI/Pjf9yJYsYNavdTglLYXlxNJE=","4":"1tg+Em7rPIJXE1gCCcqRrJYn4MGPyUPtewPNotapWjbbTRrHX+gVWM0KER2SBSCPnBQS6xH9fIGWFOj/ZLJHSIijdXqHvmW+Hh4=","5":"fiS+wQCqAou0iKOHmDtJvs1hQTDwl0TzqkGclxVD5HoKpGxVyl7NhBDR4hjWlqtHV/TADhYXYAFD47nLqNNqTtJCwRvytUiNlZU="},"nonrev_response":"B817GHmzZgCKgV6F2NXROyi8c4276s5T1efCY0seBsEHXNYfEXeiRswjretMwoTYGRN22gW0Ka+DzfWmXpsBI6vIATwa+gxNEg==","nonrev_proof":{"C_r":"iT+1G2JiCvjwo46zqOFwyFj4L4axR4Ieb8HpSt5TucB/zZMUspThsol2zQoLK9rLNI73GLiBUzFogWI88y2jIAlT+a5NjibHzykTCnv2hfRM5dXMZ55kGk3Ac3UIkTCgvBHpwk2KISxRPHX1UGGruaiHK1zSBDauxpI+Hdyscuo=","C_u":"XdQ57y5C/C9bz3LBucvqj1Ah6vKc1e5rZofNOnWWBO10DMNkz7CKgZfSNRKxJUio6h/TbQHD/o9EwtpKfhQ31JTM28vTgxpCs1U1oO+8A0hNSg7MYRozk8+prZA9pYk+TBpxsMnr9WIr5I6LEYMBgWxatLR3Trr+Mi/AlPJnbto=","responses":{"beta":"c5pZN3c0vCVRLdKDBjtR7JRm0cVFl5t5btGWD3LRMFQifngWdQHZyEQi9ZnAwAOOOlP1VSJ9I/olWyGRqrkKK7ibMP0AqmwO5D4bCvePfep1LZvchtRGPLPo6xIpLaqbvml0uU5VQEoSDVuewN7Nbup7ujUasbo3Vm0NKubXFv5Kj3s9gcu5Ak3xwdyZh71HjnDfAep9rhQHNZEpUTLvB61XwfgbzhGT343FxU3Hw39WRSaR0Kqrb4OFdh/dX9txE4zrVTmHi/w=","delta":"NcR12VF4X/24719kjGlhmiGCb+hseieedaAeUDMrOXOYVlZ/BF4c4QbqFQr3LRxlFOYIUO9MeFVHF3XCH+cIoCo3d1DWlGjNeGlNNy6qGRCUeCagCdiBGBUK5mxhB2hvu1l4g0wOEzWwt7a3Rvgo80M27ZLm6t4m9MQ7T09MwjB/MEzj0Rh6YosGWuU9AIlwMgPPf0J03JofT30nWCM54soa6XFvKnFD4sAZ0qgVMZFwb7apyI1OeDePplCRXXTCT2dAq9CvYZs=","epsilon":"NM6AOJVRV+c5YBoLp2Szg64TJulENAiF7c6f1190cHxr/S3YxcJwWDxxcFVK6ilmK5ffZvj3kJzE6ydkAGktL9VhI6H8/sBo18773AkJ0RVsNyBGcOg25vkbJEQKCDzhkwpaV8iC1BmhD3JQgNaRxseX/StEVoPiktJKbXtY85D6+G6Iw2BpuO+ucIRPs09y8iW6h7LpcGVu8/opCG1eE69zUH0ajb1oR4TuFZ4KU18=","zeta":"BRa4pWqsK2i5wEm3vATVJ83kKWOKRgVWL6TVKnNz55P1ILsfH7JsL8l8S+2c2rYiSv6nLXb9icr1hwsB2DnPyCTD0tuElwSuWzEBY6YfrgynG5Yb4H1ixWVdyH37eQlC8l7UD/qr2Jq/U1dq1zSaAUA9B3UfWxyF2UshYJlBnnXsFAxakLAPSCEodertCGuj7IQCNgBGYtgQEnlbHswr763JsRJUHCz+rZ+Inw2Kb7A="},"sacc":{"data":"omNNc2dYu6NiTnVYgCWGEk2iO53pavztto18GQ+K7W4x2iu9gx4IKMPQW98OeI5Eg1mCWSEm5Apjk6pi5JEY4zAUQnfKn+uN7kXk3A5ff5zFWB5+5TFggI73PytCps+owq+wxuXlljcV6pZRQXhDt+WnajAQZmEavIH9R4vnajjcnMkK96Muk6j2jTr+ZUluZGV4AWlFdmVudEhhc2hYIhIg542kR7yDoMEFhYbUEni4Da0kZK3162KvG7Gb79HlbbtjU2lnWEgwRgIhAMt9fdJBsAEpvfW3g8je3+hUIJ0lNnEKi/iS4PQlMSaiAiEA5aP5iigzBqCjcpeUSLF67ndV/sk4DqI7oI96PZVqWjg=","pk":0}},"a_disclosed":{"2":"/wAAAAAAAAAVY29udGVudHMubGlrZWROdW1iZXJzAAAAAAAAAAVhcnJheQAAAAAAAAAI/1sxLDIsM10=","3":"/wAAAAAAAAANY29udGVudHMubmFtZQAAAAAAAAAGc3RyaW5nAAAAAAAAAAVCZXJ0YQ=="}}]}`)
	bytePubK := []byte(`{"XMLName":{"Space":"","Local":""},"Counter":0,"ExpiryDate":1611656123,"N":"17BETaUnhSlTCPQXZUS5ZTsjzMYA5DKmV32K/UXoyd1QOa8lG6NkxjhMxyQ0myFPzlWkBsuUYHClb3yB/YSRDeESLqvxUoDhv6S9CfOM8P69XwkOOMVky8X9cM1IeYFh7wXO7OzfoXFki6dNq77vOvS4cYsBsy6A4Oy3w67xt7U=","Z":"meMW+beYJ7mwaD9lyKDf8E0mFVuro9+JoP8GQye06dpJCzVB5PvX7y8VpYf+8OQKbGgu/R3CHNww1bmzC74yDjsO/oVDKb5RXmdY6sHlBZmvRezFOhXnxhus84nZRx3mtCtePH6PPW8Kfg58a2ISrUBNgouC0TyDSUSF81VO8V4=","S":"uPE9ZXR4IdkjuNK14H/Gj1phDnBNsuwgaUB+iYYq3he14LNW/S/ttrRpS+4HIF3Xa4B172D/PZrdNbMWnRtXN99GDwL5kc+0DY0Sko3q3LyCqWkeLDfs8NLonp6WfMb9I68nB6EDpwMEr5/nkWmZbp1LM0leiih1aJXdsVbVUuE=","G":"HKAPBxY7nGMYOTS3/v2wN/GDsdP3JKBebghDFhBDSL1xefDdhoRX6SO6T2CM+aOtSpy6HEgctnLH5AjV0fYWkDSnhtWkgj3hYOaepPielVrCqLpC3dDcPAGxWNxyHqZnSKozEPyXegPT84bQd2RPiRsKaOqcYdiWaQIWUIdZaCg=","H":"H7EnoUqlcmMKFA0Gdxdhym6szZd4xM7sKhRieYO0J7kYBJn5VQo+dyAQtT6YKA2xjQdRsK6fkVdiOWMWDsfMAZ2JeKdLr9IYMArSLGiOU7k/zNXSedIJt4vK7+oUn+ZX0R8xZR7FutkRrLN0nhiSFWRa0D6wuoL/IqoC7Euwy1Q=","T":"bXeTj94ZyB7ZntvyG01N+L+aghrAwhmPDpEoGy6guR0u12JVB6x8fwMnihIcOFwsRkBBqtPIKTYf9arqPan2DpBYy4ijO5qhR2CHj16/dIvvC16WxnJ1C9FuGI6hz8eGJjJ9JSo4Sb5UyM13Z9jGksXLD2WpcSm4RmHMJ9LRfjQ=","R":["GhJlQttoVFe/6TLn7sDNhhfejUr1tgiPA1HAeJ1MGJ4K7U5L7P1zhy0EEvW4hUSMQyufm9EhxsOYFrmAtGycLSL45kb34CnU5EOJ1ziCrZuhLwBawvNkMDMAnTL+4FCStifDuM2t97i4SbnatU0NnScu+9R/AnUENowysM1/Y+Y=","qeiCq5ssM4aGiLcXAJXANEgJ31IewA9ipHOOVMn7znbuXsBscdR+EERBmhDNlxhc+kKKG+fBvwIy2MR+jKQ9gkxjNxckwQpBJm03TcEsjGEdYtTn3RDWKgXSfZD95QiINLGV/AO5zkCOIQqvBiTWid1yB+mGu7K4xUViW4/7DTI=","GazFsc2qIjGcUXGjV8OYhfAlV2BErF2G3ElPF7Zobcm1OVPesftT/ObIaZ+Ev5ZHZR3Tvn0Zvo057HalqdJ02mZk5VTrOS9hLghzzt6uOYqdvr7RWyY+kx0w6v54zhj0q7B0lHJUXFu4XfosLYpdLDsNflYcnuhYYHl1X3mTnNU=","POB2BhiWh1DU7OQlpDFDhj4paMDs03gMAccTUYXmaFnpbhkgWpojW72CdJ0vI/Acu05K8qrJhoYYMtNCePhZ87Phn2GquuhWtmF9WxtSFH1HbD5rDKEImBLqlAS5SIbz9tZoqQ36F2oFhvlx+/cj0Spt0RzsAkeSJVFbn9kbli8=","KlKU4xA34IqxmQNogwPS7OEsa9MaFxW8ccuJY6O7WQRm8S3XRCXpt4tP5Rna8/lVHl3UC/aa89s8aGmiYfDBY7ZqrU8JeGt44UdOyING8VDBMSaqRRUOVh9vVyou0w89msJ0DSXLWwW8hlynzULNT16aqzT0y7yVmZ2K7Uylf84=","HvA4ol+cJlITZThOSB6W/iScgJYXPxdSFbFDmOhA4QlIwV65aD6DwHfTQrqWEqmP7UDFY+lA6VU6+zVlvyHng1u+HF9AzqfXldDywb8KiDovmdCcOrdUIiyzvwqv1LWM2wgQS/QJtrUqe1NnWMwA2JYhxb2E8UGEt/ogMI9Glgg="],"EpochLength":432000,"Params":{"LePrime":120,"Lh":256,"Lm":256,"Ln":1024,"Lstatzk":80,"Le":597,"LeCommit":456,"LmCommit":592,"LRA":1104,"LsCommit":593,"Lv":1700,"LvCommit":2036,"LvPrime":1104,"LvPrimeCommit":1440},"Issuer":"","ECDSA":"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEcBi87SnFxjg+Og6e0g0sxNzyHyu2I8s8jAZ+aAXFTyVrJgncq2FNKFIjDkhOdwdf1sgIxRBUHu0ViKKRwzTSlA=="}`)

	pubK := &gabi.PublicKey{}
	err := json.Unmarshal(bytePubK, pubK)
	require.NoError(t, err)

	presentationResponse := &CombinedPresentationResponse{}
	err = json.Unmarshal(bytePresentationResponse, presentationResponse)
	require.NoError(t, err)

	verifierSession := &CombinedVerifierSession{}
	err = json.Unmarshal(byteVerifierSession, verifierSession)
	require.NoError(t, err)

	ok, claims, err := VerifyCombinedPresentation([]*gabi.PublicKey{pubK, pubK}, presentationResponse, verifierSession)
	assert.True(t, ok)
	require.NoError(t, err)
	require.NotNil(t, claims)
}

func TestVerifyCombinedPresentationLessKeys(t *testing.T) {
	byteVerifierSession := []byte(`{"context":"2wfkK4gbrLeq11bSehr5r/jUkQVwiluwBUePQoxm6b0=","nonce":"h6rWOZHbj9vkOTFh33wRjMhgW2Q+7YI+yR0lwHoXZ3I=","partialRequests":[{"requestedAttributes":["contents.age","contents.gender","contents.name","contents.special"],"reqNonRevocationProof":true,"reqMinIndex":1},{"requestedAttributes":["contents.name","contents.likedNumbers"],"reqNonRevocationProof":true,"reqMinIndex":1}]}`)
	bytePresentationResponse := []byte(`{"prooflist":[{"c":"TsxeePNcCRhYWJzc/cZ2sQf29taCkLpJPYaWddRf85g=","A":"z5xTl1EWxzkIttrWh9yGiQfh6xjl1yq7/iTCMks8VCiBJTXA//nvaP6ANrH1IpsFJuFbSePx/r+uFWAjst46MaPB5CRnnPLY9qPYFxuGZeYsjGit0FUsDQHQTiCqgLI9AjiOVXhgEUVL1Ps0C7l9Vvl9Ugr4R+8fcVTYanxnOoM=","e_response":"xOIIkkQv65/Ax8uhj8VGUzWSVrc6Jx/rokvrhN5DqXZJ9QHLj4VT6wzUiFtVAtWTkYi0Zw8RdlDz","v_response":"Bh3PxScFOsWR0QFcqYerXQ5RGAOgnFLs+rN3iSU6RKXhALzHOY7+HVwiZw8rgwmbtze3KLFAU83TO8BoxfegaY1244sVEJrM/IIGdRkrIsovzK7U6SVULeHYOBNmoo8CmuqDYey3kGjmGU4VhgbG9JVjIhtRKhtkUdpvJrxlGuSykT4hmi0sm9pzOHofTGn5w+BrEEh1gDeyjOEsY+eh79ks660RBsCW25z0pkpWhDxPQ3d5L7IZXq9WbkejJ8L3atd37MXea11Otf0zhN8kD0D1cSrIXsRLJFUxpA7tcXUShCTK8uw1MzJPcv/c3IuZxDs2drsWPOdhHy6BSa7n","a_responses":{"0":"hzuzfei2WDaZAFkel/idaTyl0lclq/wtI6Zmr1KWYfJKYhC8YxTe/mfLsPv2lEuvXli6jUJAoGdr0FeDLrzoiv0Q32eUiXg2mz0=","5":"wEJnx537UKLzmgqkPeRyFY6Nv3+OK0wBEaXnJqXUqPdGtBJ1LdkGQt5IxgpmRSGvLUozuvJ1G15KP6pUGFo8xu5u4GMICYDEPVA="},"nonrev_response":"BinztDiegx1dtjtgzQz/8f2OOKNEtd66XzbEHUxl8b6nLgdEeMCOQCMnHYLIE299+0CRBXfTnp6mFmJA5Jaepct3y9x2mSoyfQ==","nonrev_proof":{"C_r":"I3sWG9cnkLB15c4c48kgY4ycBlLYIGF0gwFmUWhUOUGehnxjuvnbXwjT35X1Klf7V6by4CmrPvKWC2mTiQYhBxAIo4966N6k2fy+Wrn1RFpRbVaMVwxa47T2uXxEnQZDDCR27AsCOH6TbTD8lbgBW7iT7nopcTykN+IeOV6Qhjg=","C_u":"ryis3rmVYbt9paPlNW3U4NbuMhTPa2mIJ6bbp6DDim1PzX6a353Ay7EhRC3RqKGbDdQoGkIi6GLkE828LdNusf47zj0ePPpVkD4T2t96qlzPUlfepb1NkcbXwddqjMFW9oQFVv2xJOuxi3LGQUwuW+w+X/EV9nWmaNZdbFkFKe4=","responses":{"beta":"AQpyp0dNS1NPLS6BHo+c1toKoS5wTG+vQQBztBQwjzOuWJZcvktuMS6qci6elvop47JBh5WgmyG8YBdAdPIFuFl+GFamxacyF9eLVJ4XeFShz8RGUbZAMYOfOITAzgr4rwgA2ovHNpjhOZBu2h9qoPptbsnER/YbU06MUMT/IzI9DSq/h3tFCFXHDiSG2J4gFWlVlVj+c/uU97GJR27UMDNVjtH6qnqIA6AY7WI4POv6Y2IG33NLHfhfi3Fo0PP5SN84ZBXmBOhx","delta":"oiJCm26R5rK728F+OlMLnMMKpNfrIbPS0QfF/vsLMhH+h7O4NECflaI/pEdvmp31AhQ8b6pA8/wnRmKH67OiXAksGUFuZSgBIgnuP/pgqH/a6PoMRYkQA9Ryr1s/Rzwl3IGfUSASwQWDoxeL2ITdqgVBRaBYTEjlR/+oA2X8zIqaO1V7CG1f+EgV+r4fn//bc8DhWdF6KXlG/l5I7cJyoc6fQZK//sFKfxnFR2QIby7v9lhiYf/rntifUwKCxmJ9c+12xgEUnjI=","epsilon":"E5Cf6HstqiQmt2a6boDv1uDMPZ4ro/OOy+IGjoas2lisyec0RQewiAJa2bFSoSaoBYpDthqZxEGaUa2GwPRbyV3pBn2RFat6oLisrAkld5khPECXtAkTMtbgXmbTQExP/ITiT2UH/NxzYZ7N/RD5WzJB7XXu5w8xKBCa7ACfnFutDfSlUe+jmNLQ+34oyHEwmXh+TpvezhmSimYWXIEb+rATg1BInfsEmtF5Kf0JUOc=","zeta":"H1pOIg5OfuGd2D5J9vw2kOux9JJPfU854J2QACrcbI6CCPOA3g39FhVuDmk0DpIa2M8OtjMM5JhlcIC05jRa9lSuoVlkb3XHI17NDqczjXDTgbJFph5vR3JST57I0ao3H5lBLL0qNrGQRmc7zu4hEoOtTycNFXdRF+euejk/erShyc6EnJlpe0iD2bx3o4Yg8dI1K9MUvjBFCLWh8MuPAXa2JJJrBWy4f9qnlw2htMo="},"sacc":{"data":"omNNc2dYu6NiTnVYgCWGEk2iO53pavztto18GQ+K7W4x2iu9gx4IKMPQW98OeI5Eg1mCWSEm5Apjk6pi5JEY4zAUQnfKn+uN7kXk3A5ff5zFWB5+5TFggI73PytCps+owq+wxuXlljcV6pZRQXhDt+WnajAQZmEavIH9R4vnajjcnMkK96Muk6j2jTr+ZUluZGV4AWlFdmVudEhhc2hYIhIg542kR7yDoMEFhYbUEni4Da0kZK3162KvG7Gb79HlbbtjU2lnWEgwRgIhAMt9fdJBsAEpvfW3g8je3+hUIJ0lNnEKi/iS4PQlMSaiAiEA5aP5iigzBqCjcpeUSLF67ndV/sk4DqI7oI96PZVqWjg=","pk":0}},"a_disclosed":{"1":"/wAAAAAAAAAMY29udGVudHMuYWdlAAAAAAAAAAVmbG9hdAAAAAAAAAAIQEEAAAAAAAA=","2":"/wAAAAAAAAAPY29udGVudHMuZ2VuZGVyAAAAAAAAAAZzdHJpbmcAAAAAAAAABmZlbWFsZQ==","3":"/wAAAAAAAAANY29udGVudHMubmFtZQAAAAAAAAAFYXJyYXkAAAAAAAAAFP9beyJhIjoxLCJiIjoyfSwyLDNd","4":"/wAAAAAAAAAQY29udGVudHMuc3BlY2lhbAAAAAAAAAAEYm9vbAAAAAAAAAABAQ=="}},{"c":"TsxeePNcCRhYWJzc/cZ2sQf29taCkLpJPYaWddRf85g=","A":"mPi7bJ+nrmHrTSVnxbDFNjDWgxyHhpwgwtjn7Fku7bhSMmyKllxoMggJyyyUm6VE7XhzOpDU/OW3Rls3+958Juz/8wvY2ggbaphlunKPj8i1nITBDEHwG3+FKVSl3e4BOe+lhyt/bUpnkYirIYi1D5NSRRclQxxS6MkOrPtivsI=","e_response":"cEaCziG8JNAFtKIPZBWPRT0pgs5dBnhZ8hcb2BqBJENOdR6GWLhOPgY3juPjZqmMquQye2bVWVO7","v_response":"DDiwWbX2XkfgAYK8gN3S+PzPTErkxR3bLiFgDuu9jU/3eVM218aY3GIaXb1reKQrV6MtDFym7dX3KUfXpW9+O6V+V3++Q07jR4i1isR78f3ARBG3RI5v45K9Hfa+vlaZkTEXt2dOiFps4uzJh92gm4owuJQ2q4GsDbRc/UOSUnnHQ+J6j+UkvYFxKzLPK35f2vZWUlVDMPq/npMw5vY89q8Vhj6Y0ZSWfW+TDBw3TmBVwIMRUuvvxNc0LVCbb+eszC8lzPqLI7UL45Q3m4f2ziTCr7WSpzX+mO2MeVTla2ZV7o/DpN4p/uWWv9RiQJhcW+jZa0s+XO64jxwnfkem","a_responses":{"0":"hzuzfei2WDaZAFkel/idaTyl0lclq/wtI6Zmr1KWYfJKYhC8YxTe/mfLsPv2lEuvXli6jUJAoGdr0FeDLrzoiv0Q32eUiXg2mz0=","1":"A3TXU5sIXYtu+mJ+yI1XoFjHjavrx1KR+pqAVA1ALb5P2dRSwArzxUTn5wM1ZO5MZB6doj5tbI/Pjf9yJYsYNavdTglLYXlxNJE=","4":"1tg+Em7rPIJXE1gCCcqRrJYn4MGPyUPtewPNotapWjbbTRrHX+gVWM0KER2SBSCPnBQS6xH9fIGWFOj/ZLJHSIijdXqHvmW+Hh4=","5":"fiS+wQCqAou0iKOHmDtJvs1hQTDwl0TzqkGclxVD5HoKpGxVyl7NhBDR4hjWlqtHV/TADhYXYAFD47nLqNNqTtJCwRvytUiNlZU="},"nonrev_response":"B817GHmzZgCKgV6F2NXROyi8c4276s5T1efCY0seBsEHXNYfEXeiRswjretMwoTYGRN22gW0Ka+DzfWmXpsBI6vIATwa+gxNEg==","nonrev_proof":{"C_r":"iT+1G2JiCvjwo46zqOFwyFj4L4axR4Ieb8HpSt5TucB/zZMUspThsol2zQoLK9rLNI73GLiBUzFogWI88y2jIAlT+a5NjibHzykTCnv2hfRM5dXMZ55kGk3Ac3UIkTCgvBHpwk2KISxRPHX1UGGruaiHK1zSBDauxpI+Hdyscuo=","C_u":"XdQ57y5C/C9bz3LBucvqj1Ah6vKc1e5rZofNOnWWBO10DMNkz7CKgZfSNRKxJUio6h/TbQHD/o9EwtpKfhQ31JTM28vTgxpCs1U1oO+8A0hNSg7MYRozk8+prZA9pYk+TBpxsMnr9WIr5I6LEYMBgWxatLR3Trr+Mi/AlPJnbto=","responses":{"beta":"c5pZN3c0vCVRLdKDBjtR7JRm0cVFl5t5btGWD3LRMFQifngWdQHZyEQi9ZnAwAOOOlP1VSJ9I/olWyGRqrkKK7ibMP0AqmwO5D4bCvePfep1LZvchtRGPLPo6xIpLaqbvml0uU5VQEoSDVuewN7Nbup7ujUasbo3Vm0NKubXFv5Kj3s9gcu5Ak3xwdyZh71HjnDfAep9rhQHNZEpUTLvB61XwfgbzhGT343FxU3Hw39WRSaR0Kqrb4OFdh/dX9txE4zrVTmHi/w=","delta":"NcR12VF4X/24719kjGlhmiGCb+hseieedaAeUDMrOXOYVlZ/BF4c4QbqFQr3LRxlFOYIUO9MeFVHF3XCH+cIoCo3d1DWlGjNeGlNNy6qGRCUeCagCdiBGBUK5mxhB2hvu1l4g0wOEzWwt7a3Rvgo80M27ZLm6t4m9MQ7T09MwjB/MEzj0Rh6YosGWuU9AIlwMgPPf0J03JofT30nWCM54soa6XFvKnFD4sAZ0qgVMZFwb7apyI1OeDePplCRXXTCT2dAq9CvYZs=","epsilon":"NM6AOJVRV+c5YBoLp2Szg64TJulENAiF7c6f1190cHxr/S3YxcJwWDxxcFVK6ilmK5ffZvj3kJzE6ydkAGktL9VhI6H8/sBo18773AkJ0RVsNyBGcOg25vkbJEQKCDzhkwpaV8iC1BmhD3JQgNaRxseX/StEVoPiktJKbXtY85D6+G6Iw2BpuO+ucIRPs09y8iW6h7LpcGVu8/opCG1eE69zUH0ajb1oR4TuFZ4KU18=","zeta":"BRa4pWqsK2i5wEm3vATVJ83kKWOKRgVWL6TVKnNz55P1ILsfH7JsL8l8S+2c2rYiSv6nLXb9icr1hwsB2DnPyCTD0tuElwSuWzEBY6YfrgynG5Yb4H1ixWVdyH37eQlC8l7UD/qr2Jq/U1dq1zSaAUA9B3UfWxyF2UshYJlBnnXsFAxakLAPSCEodertCGuj7IQCNgBGYtgQEnlbHswr763JsRJUHCz+rZ+Inw2Kb7A="},"sacc":{"data":"omNNc2dYu6NiTnVYgCWGEk2iO53pavztto18GQ+K7W4x2iu9gx4IKMPQW98OeI5Eg1mCWSEm5Apjk6pi5JEY4zAUQnfKn+uN7kXk3A5ff5zFWB5+5TFggI73PytCps+owq+wxuXlljcV6pZRQXhDt+WnajAQZmEavIH9R4vnajjcnMkK96Muk6j2jTr+ZUluZGV4AWlFdmVudEhhc2hYIhIg542kR7yDoMEFhYbUEni4Da0kZK3162KvG7Gb79HlbbtjU2lnWEgwRgIhAMt9fdJBsAEpvfW3g8je3+hUIJ0lNnEKi/iS4PQlMSaiAiEA5aP5iigzBqCjcpeUSLF67ndV/sk4DqI7oI96PZVqWjg=","pk":0}},"a_disclosed":{"2":"/wAAAAAAAAAVY29udGVudHMubGlrZWROdW1iZXJzAAAAAAAAAAVhcnJheQAAAAAAAAAI/1sxLDIsM10=","3":"/wAAAAAAAAANY29udGVudHMubmFtZQAAAAAAAAAGc3RyaW5nAAAAAAAAAAVCZXJ0YQ=="}}]}`)
	bytePubK := []byte(`{"XMLName":{"Space":"","Local":""},"Counter":0,"ExpiryDate":1611656123,"N":"17BETaUnhSlTCPQXZUS5ZTsjzMYA5DKmV32K/UXoyd1QOa8lG6NkxjhMxyQ0myFPzlWkBsuUYHClb3yB/YSRDeESLqvxUoDhv6S9CfOM8P69XwkOOMVky8X9cM1IeYFh7wXO7OzfoXFki6dNq77vOvS4cYsBsy6A4Oy3w67xt7U=","Z":"meMW+beYJ7mwaD9lyKDf8E0mFVuro9+JoP8GQye06dpJCzVB5PvX7y8VpYf+8OQKbGgu/R3CHNww1bmzC74yDjsO/oVDKb5RXmdY6sHlBZmvRezFOhXnxhus84nZRx3mtCtePH6PPW8Kfg58a2ISrUBNgouC0TyDSUSF81VO8V4=","S":"uPE9ZXR4IdkjuNK14H/Gj1phDnBNsuwgaUB+iYYq3he14LNW/S/ttrRpS+4HIF3Xa4B172D/PZrdNbMWnRtXN99GDwL5kc+0DY0Sko3q3LyCqWkeLDfs8NLonp6WfMb9I68nB6EDpwMEr5/nkWmZbp1LM0leiih1aJXdsVbVUuE=","G":"HKAPBxY7nGMYOTS3/v2wN/GDsdP3JKBebghDFhBDSL1xefDdhoRX6SO6T2CM+aOtSpy6HEgctnLH5AjV0fYWkDSnhtWkgj3hYOaepPielVrCqLpC3dDcPAGxWNxyHqZnSKozEPyXegPT84bQd2RPiRsKaOqcYdiWaQIWUIdZaCg=","H":"H7EnoUqlcmMKFA0Gdxdhym6szZd4xM7sKhRieYO0J7kYBJn5VQo+dyAQtT6YKA2xjQdRsK6fkVdiOWMWDsfMAZ2JeKdLr9IYMArSLGiOU7k/zNXSedIJt4vK7+oUn+ZX0R8xZR7FutkRrLN0nhiSFWRa0D6wuoL/IqoC7Euwy1Q=","T":"bXeTj94ZyB7ZntvyG01N+L+aghrAwhmPDpEoGy6guR0u12JVB6x8fwMnihIcOFwsRkBBqtPIKTYf9arqPan2DpBYy4ijO5qhR2CHj16/dIvvC16WxnJ1C9FuGI6hz8eGJjJ9JSo4Sb5UyM13Z9jGksXLD2WpcSm4RmHMJ9LRfjQ=","R":["GhJlQttoVFe/6TLn7sDNhhfejUr1tgiPA1HAeJ1MGJ4K7U5L7P1zhy0EEvW4hUSMQyufm9EhxsOYFrmAtGycLSL45kb34CnU5EOJ1ziCrZuhLwBawvNkMDMAnTL+4FCStifDuM2t97i4SbnatU0NnScu+9R/AnUENowysM1/Y+Y=","qeiCq5ssM4aGiLcXAJXANEgJ31IewA9ipHOOVMn7znbuXsBscdR+EERBmhDNlxhc+kKKG+fBvwIy2MR+jKQ9gkxjNxckwQpBJm03TcEsjGEdYtTn3RDWKgXSfZD95QiINLGV/AO5zkCOIQqvBiTWid1yB+mGu7K4xUViW4/7DTI=","GazFsc2qIjGcUXGjV8OYhfAlV2BErF2G3ElPF7Zobcm1OVPesftT/ObIaZ+Ev5ZHZR3Tvn0Zvo057HalqdJ02mZk5VTrOS9hLghzzt6uOYqdvr7RWyY+kx0w6v54zhj0q7B0lHJUXFu4XfosLYpdLDsNflYcnuhYYHl1X3mTnNU=","POB2BhiWh1DU7OQlpDFDhj4paMDs03gMAccTUYXmaFnpbhkgWpojW72CdJ0vI/Acu05K8qrJhoYYMtNCePhZ87Phn2GquuhWtmF9WxtSFH1HbD5rDKEImBLqlAS5SIbz9tZoqQ36F2oFhvlx+/cj0Spt0RzsAkeSJVFbn9kbli8=","KlKU4xA34IqxmQNogwPS7OEsa9MaFxW8ccuJY6O7WQRm8S3XRCXpt4tP5Rna8/lVHl3UC/aa89s8aGmiYfDBY7ZqrU8JeGt44UdOyING8VDBMSaqRRUOVh9vVyou0w89msJ0DSXLWwW8hlynzULNT16aqzT0y7yVmZ2K7Uylf84=","HvA4ol+cJlITZThOSB6W/iScgJYXPxdSFbFDmOhA4QlIwV65aD6DwHfTQrqWEqmP7UDFY+lA6VU6+zVlvyHng1u+HF9AzqfXldDywb8KiDovmdCcOrdUIiyzvwqv1LWM2wgQS/QJtrUqe1NnWMwA2JYhxb2E8UGEt/ogMI9Glgg="],"EpochLength":432000,"Params":{"LePrime":120,"Lh":256,"Lm":256,"Ln":1024,"Lstatzk":80,"Le":597,"LeCommit":456,"LmCommit":592,"LRA":1104,"LsCommit":593,"Lv":1700,"LvCommit":2036,"LvPrime":1104,"LvPrimeCommit":1440},"Issuer":"","ECDSA":"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEcBi87SnFxjg+Og6e0g0sxNzyHyu2I8s8jAZ+aAXFTyVrJgncq2FNKFIjDkhOdwdf1sgIxRBUHu0ViKKRwzTSlA=="}`)

	pubK := &gabi.PublicKey{}
	err := json.Unmarshal(bytePubK, pubK)
	require.NoError(t, err)

	presentationResponse := &CombinedPresentationResponse{}
	err = json.Unmarshal(bytePresentationResponse, presentationResponse)
	require.NoError(t, err)

	verifierSession := &CombinedVerifierSession{}
	err = json.Unmarshal(byteVerifierSession, verifierSession)
	require.NoError(t, err)

	ok, claims, err := VerifyCombinedPresentation([]*gabi.PublicKey{pubK}, presentationResponse, verifierSession)
	assert.False(t, ok)
	require.NoError(t, err)
	require.Nil(t, claims)
}
